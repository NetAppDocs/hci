---
sidebar: docs_sidebar
permalink: docs/task_rancher_deploy.html
summary: Learn about tasks you might need to perform after installing Rancher on NetApp HCI.
keywords: netapp, hci, rancher, deploy, cluster, kubernetes
---

= Deploy Rancher on NetApp HCI
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
You want to use Rancher to deploy Kubernetes clusters on your NetApp HCI environment. You will deploy a Kubernetes cluster containing the Rancher Server.



== What happens when you deploy Rancher on NetApp HCI?
The deployment involves the following steps, each described further:

* Use the Hybrid Cloud Control to initiate the deployment.

* The Rancher deployment creates a management cluster, which includes three virtual machines.
+
Each virtual machine is assigned all Kubernetes roles for both the Control Plane and Worker. This means that the Rancher UI is available on each node.

* The Rancher Control Plane (or _Rancher Server_) is also installed, using the NetApp HCI node template in Rancher for easier deployment. The Rancher Control Plane automatically works with the configuration used in the NetApp Deployment Engine, which was used to build the NetApp HCI infrastructure.

* After deployment, Dev and Ops teams can then deploy their user clusters, similar to any Rancher deployment.

== Deployment considerations
You might want to review the following considerations:

* Types of deployments
* Round-robin DNS
* L4 load balancer
* Rancher FQDN
* Node details

=== Types of deployments
You can deploy Rancher on NetApp HCI in the following ways:

* *Demo deployments*: If DHCP is available in the targeted deployment environment and you want to demo the Rancher on NetApp HCI capability, then a DHCP deployment makes the most sense.
+
In this deployment model, the Rancher UI is accessible from each of the three nodes in the management cluster.

+
If your organization does not use DHCP, you can still try it out by using four static IP addresses allocated prior the deployment, similar to what you would do for a production deployment.

* *Production deployments*: For production deployments or when DHCP is not available in the targeted deployment environment, a little more pre-deployment work is required.  The first step is to obtain three consecutive IP addresses. You enter the first during the deployment.

+
We recommend an L4 load balancer or round-robin DNS configuration for production environments.  This requires a fourth IP address and separate entry in your DNS configuration.

==== Round-robin DNS
This is a technique where a single host name is configured in the DNS system that rotates requests among the three hosts that form the management cluster.

==== L4 load balancer
This is a technique where a virtual machine or container hosting an application like nginx is configured to distribute requests among the three nodes of the management cluster.

=== Rancher FQDN

The installation requires assignment of a Rancher URL, which includes the fully qualified domain name (FQDN) of the host where the Rancher UI will be served once the installation is complete.  The following table demonstrates how you will access the Rancher UI based on configuration parameters of the deployment.

In all cases the Rancher UI is accessible in your browser over https protocol (port 443).


[cols=3*,options="header",cols="15,15, 15"]
|===
| IP addressing
| Rancher FQDN
| Rancher UI access
|DHCP | Not applicable | Available from all three nodes by wildcard DNS. Consider adding round-robin DNS or a load balancer.
| DHCP | FQDN | Served by the FQDN, which resolves based on your DNS.
| Static | Not applicable | Available from all three nodes by wildcard DNS. Consider adding round-robin DNS or a load balancer.
| Static | FQDN | Served by the FQDN, which resolves based on your DNS.
|===

=== Node details

Rancher on NetApp HCI deploys a three-node management cluster.

All nodes have the following characteristics:

[cols=3*,options="header",cols="15,15, 15"]
|===
| vCPU
| RAM (GB)
| Disk (GB)
| 2 | 8 | 20
|===

A minimum of 60GB is required to deploy Rancher Server.

== Steps to deploy Rancher on NetApp HCI

=== Access the NetApp Hybrid Cloud Control

To begin the deployment, access the NetApp Hybrid Cloud Control.

. Open a web browser and browse to the IP address of the management node. For example:
+
https://_<ManagementNodeIP>_
. Log in to NetApp Hybrid Cloud Control by providing the NetApp HCI storage cluster administrator credentials.
+
The NetApp Hybrid Cloud Control interface appears.


=== Deploy Rancher on NetApp HCI

. From the Hybrid Cloud Control, click the *Rancher* icon in the lower left of the navigation bar.
+
image::rancher_hcc_dashboard.png[NetApp Hybrid Cloud Control Dashboard and Rancher icon]
+
A popup window shows a message about getting started with Rancher.
+
image::rancher_hcc_getstarted.png[Rancher Getting Started image]

. Click *Deploy Rancher*.
+
The Rancher UI appears.
+
image::rancher_hcc_deploy_vcenter.png[Rancher deployment page]
Your vCenter credentials are collected based on your NetApp Deployment Engine installation.

. Enter *vCenter Resources* information

* *Datacenter*: Select a datacenter. After you select the datacenter, all other fields are prepopulated, although you can change them.
* *Datastore*:
* *Resource Pool*:
* *Management network*:

. Enter *Deployment Settings* information

* *Rancher Server Admin Password*:
* *Cluster name*:
* *DNS Servers*: Optionally, enter
* *Rancher Server FQDN*: To ensure that the Rancher Server remains available during node failures, provide a fully-qualified domain name (FQDN) that your DNS server can resolve to any of the IP addresses assigned to the Rancher Server cluster's nodes. This FQDN with the "https" prefix becomes the Rancher URL that you will use to access your Rancher implementation.
+
If no domain name is provided, wildcard DNS will be used instead and you will be able to access the Rancher Server using one of the URLs presented after the deployment completes.

. Enter *Advanced Settings* information

* *Assign Static IP Addresses*:
+
If you enable static IP addressing, the following additional fields appear:

** Subnet Mask:
** Default Gateway:
** Starting IP Address:
** Ending IP Address:

* *Configure Proxy Server*:

. Review and select the checkbox for the Rancher End User License Agreement.
. Review and select the checkbox to acknowledge information about Rancher software.

. Click *Deploy*.
+
A bar indicates the deployment progress.
+
TIP: The Rancher deployment could take about 15 minutes.

+
When the deployment is complete, Rancher displays a message about the completion and provides a Rancher URL.
+
image::rancher_deploy_complete_url.png[Rancher deployment completion and URL]

. Record that Rancher URL that displays at the end of the deployment. You will use this URL to access the Rancher UI.

=== Verify your deployment by using vCenter Server

In your vSphere client, you can see the Rancher management cluster, which includes the three virtual machines.


=== Obtain and register Technical Support

After deployment, an email is sent to you that includes a Support registration code.

. Go to https://mysupport.netapp.com and log in. ZZ WHERE DO YOU GO TO GET THE SUPPORT OPTION?
. Open the email sent to you from NetApp after the Rancher on NetApp HCI deployment and locate the Support registration code.
. Use the code to register your deployment with Rancher as well as NetApp Support.

== What's next?
After deployment, you can do the following:

* Deploy user clusters
* Change the admin user credentials
* Install Trident with Rancher on NetApp HCI

ZZ MAYBE MAKE THESE THEIR OWN POST DEPLOYMENT TASKS And LINK TO THEM

=== Deploy user clusters
After deployment, Dev and Ops teams can then deploy their user clusters, similar to any Rancher deployment.

. Go to the Rancher URL provided to you at the end of the Rancher deployment.

See ZZ LINK to RANCHER DOCS

=== Change the admin user credentials and URL

. Go to myrancher.org
. Change the password for the default Rancher admin user.
. Review and accept the terms.
. Click *Continue*.
+
Rancher displays a field where you can enter the Rancher URL.

. Enter the Rancher URL that you can use to access your Rancher deployment.
. Click *Save URL.*
+
The Rancher Clusters page shows that the virtual machines.

=== Install Trident

ZZ MOVE THIS TO ITS OWN TOPIC and LINK TO IT.

The Rancher installer makes a catalog for Trident on Rancher.

. From the Rancher UI, click *Tools* > *Catalog*.
. Select your user clusters.
. Click *Apps*.
. Click the *NetApp Trident* catalog.
+
The Catalog for the Trident installer appears.

. Provision peristent volumes that will use NetApp HCI storage.



[discrete]
== Find more information
* https://rancher.com/docs/rancher/v2.x/en/overview/architecture/[Rancher documentation about architecture^]
* https://rancher.com/docs/rancher/v2.x/en/overview/concepts/[Kubernetes terminology for Rancher]
* https://docs.netapp.com/us-en/vcp/index.html[NetApp Element Plug-in for vCenter Server^]
* https://www.netapp.com/us/documentation/hci.aspx[NetApp HCI Resources page^]
